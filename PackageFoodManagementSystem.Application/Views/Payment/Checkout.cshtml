@* @{
    ViewData["Title"] = "Checkout";
}

<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card shadow border-0 p-4" style="border-radius: 20px;">
                <h2 class="fw-bold mb-4 text-center">💳 Secure <span class="text-warning">Checkout</span></h2>
                <p class="text-muted text-center mb-4">Select your preferred payment method to complete the order.</p>

                <form asp-controller="Payment" asp-action="Confirm" method="post" id="paymentForm">
                    <div class="payment-options d-flex flex-column gap-3 mb-4">

                        <label class="payment-card p-3 border rounded-3 d-flex align-items-center cursor-pointer">
                            <input type="radio" name="method" value="Card" class="d-none" required>
                            <div class="icon-box me-3 bg-primary text-white rounded-circle d-flex align-items-center justify-content-center" style="width:50px; height:50px;">
                                <i class="fa-solid fa-credit-card"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-0 fw-bold">Pay by Card</h6>
                                <small class="text-muted">Visa, Mastercard, RuPay</small>
                            </div>
                            <div class="check-mark opacity-0 text-success"><i class="fa-solid fa-circle-check fs-4"></i></div>
                        </label>

                        <label class="payment-card p-3 border rounded-3 d-flex align-items-center cursor-pointer">
                            <input type="radio" name="method" value="UPI" class="d-none">
                            <div class="icon-box me-3 bg-success text-white rounded-circle d-flex align-items-center justify-content-center" style="width:50px; height:50px;">
                                <i class="fa-solid fa-mobile-screen-button"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-0 fw-bold">Pay by UPI</h6>
                                <small class="text-muted">Google Pay, PhonePe, Paytm</small>
                            </div>
                            <div class="check-mark opacity-0 text-success"><i class="fa-solid fa-circle-check fs-4"></i></div>
                        </label>

                        <label class="payment-card p-3 border rounded-3 d-flex align-items-center cursor-pointer">
                            <input type="radio" name="method" value="COD" class="d-none">
                            <div class="icon-box me-3 bg-warning text-dark rounded-circle d-flex align-items-center justify-content-center" style="width:50px; height:50px;">
                                <i class="fa-solid fa-hand-holding-dollar"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-0 fw-bold">Cash on Delivery</h6>
                                <small class="text-muted">Pay when you receive</small>
                            </div>
                            <div class="check-mark opacity-0 text-success"><i class="fa-solid fa-circle-check fs-4"></i></div>
                        </label>

                    </div>

                    <button type="submit" class="btn btn-dark btn-lg w-100 py-3 shadow-sm rounded-pill fw-bold mt-2" id="btnPlaceOrder">
                        Place Order <i class="fa-solid fa-arrow-right ms-2"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
    .payment-card {
        transition: all 0.3s ease;
        cursor: pointer;
        border: 2px solid #f1f1f1 !important;
    }

        .payment-card:hover {
            background-color: #f8f9fa;
            transform: translateY(-2px);
        }

    /* Selection Logic */
    input[type="radio"]:checked + .icon-box + div + .check-mark,
    input[type="radio"]:checked ~ .check-mark {
        opacity: 1 !important;
    }

    label:has(input[type="radio"]:checked) {
        border-color: #198754 !important; /* Green Border */
        background-color: #f0fff4;
    }

    .cursor-pointer {
        cursor: pointer;
    }
</style>

<script>
    // Optional: Add a subtle vibration or sound effect when selecting
    document.querySelectorAll('.payment-card').forEach(card => {
        card.addEventListener('click', () => {
            // Logic to clear other borders if :has() selector isn't supported in old browsers
            document.querySelectorAll('.payment-card').forEach(c => c.classList.remove('border-success'));
        });
    });
</script> *@









@{
    ViewData["Title"] = "Checkout";
}

<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card shadow border-0 p-4" style="border-radius: 20px;">
                <h2 class="fw-bold mb-2 text-center">💳 Secure <span class="text-warning">Checkout</span></h2>

                <div class="bg-light p-3 rounded-3 mb-4 d-flex justify-content-between align-items-center">
                    <span class="text-muted">Total Payable:</span>
                    <span class="h4 fw-bold text-success mb-0" id="displayTotal">₹0.00</span>
                </div>

                <form id="paymentForm" asp-controller="Payment" asp-action="Confirm" method="post" onsubmit="return handlePlaceOrder()">
                    <input type="hidden" name="amount" id="hiddenAmount">

                    <div class="payment-options d-flex flex-column gap-3 mb-4">
                        <label class="payment-card p-3 border rounded-3 d-flex align-items-center">
                            <input type="radio" name="method" value="Card" class="d-none" required>
                            <div class="icon-box me-3 bg-primary text-white rounded-circle d-flex align-items-center justify-content-center" style="width:50px; height:50px;">
                                <i class="fa-solid fa-credit-card"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-0 fw-bold">Pay by Card</h6>
                                <small class="text-muted">Visa, Mastercard</small>
                            </div>
                            <div class="check-mark opacity-0 text-success"><i class="fa-solid fa-circle-check fs-4"></i></div>
                        </label>

                        <label class="payment-card p-3 border rounded-3 d-flex align-items-center">
                            <input type="radio" name="method" value="UPI" class="d-none">
                            <div class="icon-box me-3 bg-success text-white rounded-circle d-flex align-items-center justify-content-center" style="width:50px; height:50px;">
                                <i class="fa-solid fa-mobile-screen-button"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-0 fw-bold">Pay by UPI</h6>
                                <small class="text-muted">Google Pay, PhonePe</small>
                            </div>
                            <div class="check-mark opacity-0 text-success"><i class="fa-solid fa-circle-check fs-4"></i></div>
                        </label>

                        <label class="payment-card p-3 border rounded-3 d-flex align-items-center">
                            <input type="radio" name="method" value="COD" class="d-none">
                            <div class="icon-box me-3 bg-warning text-dark rounded-circle d-flex align-items-center justify-content-center" style="width:50px; height:50px;">
                                <i class="fa-solid fa-hand-holding-dollar"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-0 fw-bold">Cash on Delivery</h6>
                                <small class="text-muted">Pay at doorstep</small>
                            </div>
                            <div class="check-mark opacity-0 text-success"><i class="fa-solid fa-circle-check fs-4"></i></div>
                        </label>
                    </div>

                    <button type="submit" class="btn btn-dark btn-lg w-100 py-3 shadow-sm rounded-pill fw-bold">
                        Place Order <i class="fa-solid fa-arrow-right ms-2"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
    .payment-card {
        transition: 0.3s;
        cursor: pointer;
        border: 2px solid #f1f1f1 !important;
    }

        .payment-card:hover {
            background: #f8f9fa;
            transform: translateY(-2px);
        }

    label:has(input:checked) {
        border-color: #198754 !important;
        background: #f0fff4;
    }

    input:checked ~ .check-mark {
        opacity: 1 !important;
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const total = localStorage.getItem("orderTotal");
        if (total && total !== "0.00") {
            document.getElementById('displayTotal').innerText = "₹" + total;
            document.getElementById('hiddenAmount').value = total;

            const btn = document.querySelector('#paymentForm button[type="submit"]');
            btn.innerHTML = `Place Order (₹${total}) <i class="fa-solid fa-arrow-right ms-2"></i>`;
        }
    });

    function handlePlaceOrder() {
        // 1. Get current cart and total
        const cart = JSON.parse(localStorage.getItem("myCart")) || [];
        const total = localStorage.getItem("orderTotal") || "0.00";
        const method = document.querySelector('input[name="method"]:checked').value;

        if (cart.length === 0) {
            alert("Basket is empty!");
            return false;
        }

        // 2. Create Order Object
        const newOrder = {
            orderId: "#ORD" + Math.floor(Math.random() * 900000 + 100000),
            date: new Date().toLocaleString(),
            items: cart,
            amount: total,
            paymentMethod: method,
            status: "Placed"
        };

        // 3. Save to History
        let pastOrders = JSON.parse(localStorage.getItem("pastOrders")) || [];
        pastOrders.unshift(newOrder); // Add to start of array
        localStorage.setItem("pastOrders", JSON.stringify(pastOrders));

        // 4. Clear Cart
        localStorage.removeItem("myCart");
        localStorage.removeItem("orderTotal");

        return true; // Allows the form to submit to the Controller
    }
</script>






